(self.webpackChunkmodules_role=self.webpackChunkmodules_role||[]).push([["views/role"],{2218:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return v}});var t=l(520),o=l(5428);function r(e,a){if(0===arguments.length||!e)return null;const l=a||"{y}-{m}-{d} {h}:{i}:{s}";let t;"object"==typeof e?t=e:("string"==typeof e&&/^[0-9]+$/.test(e)?e=parseInt(e):"string"==typeof e&&(e=e.replace(new RegExp(/-/gm),"/").replace("T"," ").replace(new RegExp(/\.\d{3}/gm),"")),"number"==typeof e&&10===e.toString().length&&(e*=1e3),t=new Date(e));const o={y:t.getFullYear(),m:t.getMonth()+1,d:t.getDate(),h:t.getHours(),i:t.getMinutes(),s:t.getSeconds(),a:t.getDay()};return l.replace(/{([ymdhisa])+}/g,((e,a)=>{let l=o[a];return"a"===a?["日","一","二","三","四","五","六"][l]:(e.length>0&&l<10&&(l="0"+l),l||0)}))}var n=l(6764),d=l(122);const i={class:"page"},u={class:"search-box"},c={class:"right-tool"},s={class:"table-box"},p={style:{width:"100%",border:"1px solid rgb(228 231 237)",padding:"5px"}},m={class:"dialog-footer"},f={class:"dialog-footer"};var v={__name:"role",setup(e){let a=(0,t.ref)([]);const l={children:"children",label:"name"},v=(0,t.ref)({pageNo:1,pageSize:20,total:0,name:""}),h=(0,t.ref)({id:"",name:"",code:"",expand:!1,selectAll:!1}),V=(0,t.ref)({id:"",name:"",code:"",description:""}),g=(0,t.reactive)({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}]}),x=(0,t.ref)(),C=(0,t.ref)(),N=(0,t.ref)(),w=(0,t.ref)();let b=(0,t.ref)(!1),k=(0,t.ref)(!1),y=(0,t.ref)(""),_=(0,t.ref)([]),z=(0,t.ref)(!1),T=(0,t.ref)(!1);function E(){N.value.validate((e=>{var a;e&&(a=V.value,axios.post("/api/role/addOrUpdate",a)).then((e=>{200===e.code?(n.z8.success("操作成功"),k.value=!1,S(),U()):n.z8.error(e.msg)}))}))}function R(){S(),y.value="添加角色",k.value=!0}function U(){var e;z.value=!0,(e=v.value,axios.post("/api/role/page",e)).then((e=>{_.value=e.data.list,v.value.total=e.data.total,z.value=!1}))}function M(){v.value={name:""},C.value.resetFields()}function S(){V.value={id:"",name:"",code:"",description:""},N.value&&N.value.resetFields()}function j(){h.value={id:"",name:"",code:"",expand:!1,selectAll:!1},w.value&&w.value.resetFields()}function F(){h.value.expand?Object.values(x.value.store.nodesMap).forEach((e=>e.expand())):Object.values(x.value.store.nodesMap).forEach((e=>e.collapse()))}function D(){h.value.selectAll?Object.values(x.value.store.nodesMap).forEach((e=>{e.checked=!0})):Object.values(x.value.store.nodesMap).forEach((e=>{e.checked=!1}))}function O(){var e;(e={menuIds:[...x.value.getCheckedKeys(),...x.value.getHalfCheckedKeys()],roleId:h.value.id},axios.post("/api/role/assignRoleMenu",e)).then((e=>{200===e.code&&e.data?(n.z8.success("操作成功"),b.value=!1,j()):n.z8.error(e.msg)}))}return U(),(e,B)=>{const I=(0,t.resolveComponent)("el-input"),A=(0,t.resolveComponent)("el-form-item"),H=(0,t.resolveComponent)("el-button"),K=(0,t.resolveComponent)("el-form"),Y=(0,t.resolveComponent)("el-col"),q=(0,t.resolveComponent)("el-row"),J=(0,t.resolveComponent)("el-table-column"),$=(0,t.resolveComponent)("el-table"),G=(0,t.resolveComponent)("el-pagination"),P=(0,t.resolveComponent)("el-checkbox"),L=(0,t.resolveComponent)("el-tree"),Q=(0,t.resolveComponent)("el-dialog"),W=(0,t.resolveDirective)("loading");return(0,t.openBlock)(),(0,t.createElementBlock)("div",i,[(0,t.createElementVNode)("div",u,[(0,t.createVNode)(K,{inline:!0,model:v.value,class:"demo-form-inline",ref_key:"searchFormRef",ref:C},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(A,{label:"角色名称"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(I,{modelValue:v.value.name,"onUpdate:modelValue":B[0]||(B[0]=e=>v.value.name=e),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.createVNode)(A,null,{default:(0,t.withCtx)((()=>[(0,t.createVNode)(H,{type:"primary",onClick:U,icon:(0,t.unref)(o.olm)},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("查询")])),_:1},8,["icon"]),(0,t.createVNode)(H,{icon:(0,t.unref)(o.hYj),onClick:M},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("重置")])),_:1},8,["icon"])])),_:1})])),_:1},8,["model"])]),(0,t.createVNode)(q,{gutter:10,class:"mb8"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(Y,{span:1.5},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(H,{icon:(0,t.unref)(o.v37),type:"primary",plain:"",onClick:R},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("新增")])),_:1},8,["icon"])])),_:1}),(0,t.createElementVNode)("div",c,[(0,t.createVNode)(H,{icon:(0,t.unref)(o.hYj),circle:"",onClick:U},null,8,["icon"])])])),_:1}),(0,t.createElementVNode)("div",s,[(0,t.withDirectives)(((0,t.openBlock)(),(0,t.createBlock)($,{data:(0,t.unref)(_),style:{width:"100%",height:"100%"},"row-key":"id"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(J,{prop:"name",label:"角色名称","min-width":"150"}),(0,t.createVNode)(J,{prop:"code",label:"角色编码","min-width":"150"}),(0,t.createVNode)(J,{prop:"description",label:"描述","min-width":"240"}),(0,t.createVNode)(J,{prop:"createTime",label:"创建时间","min-width":"120"},{default:(0,t.withCtx)((e=>[(0,t.createElementVNode)("span",null,(0,t.toDisplayString)((0,t.unref)(r)(e.row.createTime)),1)])),_:1}),(0,t.createVNode)(J,{label:"操作",width:"240",fixed:"right"},{default:(0,t.withCtx)((e=>[(0,t.createVNode)(H,{size:"small",type:"primary",link:"",icon:(0,t.unref)(o.I8b),onClick:a=>{return l=e.row,S(),y.value="修改角色",k.value=!0,void(t=l.id,axios.get("/api/role/get?id="+t)).then((e=>{V.value=e.data}));var l,t}},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("修改")])),_:2},1032,["icon","onClick"]),(0,t.createVNode)(H,{size:"small",type:"primary",link:"",icon:(0,t.unref)(o.wn$),onClick:l=>{var t,o;"admin"!==(t=e.row).code?(j(),b.value=!0,h.value.name=t.name,h.value.code=t.code,h.value.id=t.id,y.value="菜单权限",T.value=!0,(o={},axios.post("/api/menu/list",o)).then((e=>{var l;a.value=function(e,a,l,t,o){a=a||"id",l=l||"parentId",t=t||"children",o=o||Math.min.apply(Math,e.map((e=>e[l])))||0;const r=JSON.parse(JSON.stringify(e)),n=r.filter((e=>{let t=r.filter((t=>e[a]===t[l]));return t.length>0&&(e.children=t),e[l]===o}));return""!==n?n:e}(e.data,"id","parentId","children","-1"),(l=t.id,axios.get("/api/role/getRoleMenus?id="+l)).then((e=>{x.value.setCheckedKeys(e.data),T.value=!1}))}))):n.z8.warning("admin角色默认拥有所有权限,不可修改")}},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("菜单权限")])),_:2},1032,["icon","onClick"]),(0,t.createVNode)(H,{size:"small",type:"primary",link:"",icon:(0,t.unref)(o.HG3),onClick:a=>{return l=e.row,void d.T.confirm("确定要删除["+l.name+"]吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{var e;(e=l.id,axios.delete("/api/role/del?id="+e)).then((e=>{200===e.code&&e.data?(n.z8.success("删除成功"),U()):n.z8.error(e.msg)}))})).catch((()=>{}));var l}},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("删除")])),_:2},1032,["icon","onClick"])])),_:1})])),_:1},8,["data"])),[[W,(0,t.unref)(z)]]),(0,t.createVNode)(G,{"current-page":v.value.pageNo,"onUpdate:currentPage":B[1]||(B[1]=e=>v.value.pageNo=e),"page-size":v.value.pageSize,"onUpdate:pageSize":B[2]||(B[2]=e=>v.value.pageSize=e),"page-sizes":[10,20,30,50],layout:"total,sizes,prev, pager, next, jumper",background:"",small:"",onChange:U,total:v.value.total},null,8,["current-page","page-size","total"])]),(0,t.createVNode)(Q,{modelValue:(0,t.unref)(b),"onUpdate:modelValue":B[8]||(B[8]=e=>(0,t.isRef)(b)?b.value=e:b=e),title:(0,t.unref)(y),width:"600px",draggable:""},{footer:(0,t.withCtx)((()=>[(0,t.createElementVNode)("span",m,[(0,t.createVNode)(H,{type:"primary",onClick:O},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("确 定")])),_:1}),(0,t.createVNode)(H,{onClick:B[7]||(B[7]=e=>{(0,t.isRef)(b)?b.value=!1:b=!1,j()})},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("取 消")])),_:1})])])),default:(0,t.withCtx)((()=>[(0,t.createVNode)(K,{ref_key:"menuFormRef",ref:w,model:h.value,"label-width":"80px",class:"demo-ruleForm","status-icon":""},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(A,{label:"角色名称",prop:"name"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(I,{modelValue:h.value.name,"onUpdate:modelValue":B[3]||(B[3]=e=>h.value.name=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.createVNode)(A,{label:"角色编码",prop:"code"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(I,{modelValue:h.value.code,"onUpdate:modelValue":B[4]||(B[4]=e=>h.value.code=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.createVNode)(A,{label:"菜单权限",prop:"code"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(P,{modelValue:h.value.expand,"onUpdate:modelValue":B[5]||(B[5]=e=>h.value.expand=e),label:"展开/折叠",onChange:F},null,8,["modelValue"]),(0,t.createVNode)(P,{modelValue:h.value.selectAll,"onUpdate:modelValue":B[6]||(B[6]=e=>h.value.selectAll=e),label:"全选/全不选",onChange:D},null,8,["modelValue"]),(0,t.createElementVNode)("div",p,[(0,t.withDirectives)((0,t.createVNode)(L,{props:l,data:(0,t.unref)(a),"node-key":"id","show-checkbox":"",ref_key:"menuTree",ref:x,"check-strictly":!0},null,8,["data"]),[[W,(0,t.unref)(T)]])])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"]),(0,t.createVNode)(Q,{modelValue:(0,t.unref)(k),"onUpdate:modelValue":B[13]||(B[13]=e=>(0,t.isRef)(k)?k.value=e:k=e),title:(0,t.unref)(y),width:"600px",draggable:""},{footer:(0,t.withCtx)((()=>[(0,t.createElementVNode)("span",f,[(0,t.createVNode)(H,{type:"primary",onClick:E},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("确 定")])),_:1}),(0,t.createVNode)(H,{onClick:B[12]||(B[12]=e=>{(0,t.isRef)(k)?k.value=!1:k=!1,S()})},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)("取 消")])),_:1})])])),default:(0,t.withCtx)((()=>[(0,t.createVNode)(K,{ref_key:"addFormRef",ref:N,model:V.value,"label-width":"80px","status-icon":"",rules:g},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(A,{label:"角色名称",prop:"name"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(I,{modelValue:V.value.name,"onUpdate:modelValue":B[9]||(B[9]=e=>V.value.name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),(0,t.createVNode)(A,{label:"角色编码",prop:"code"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(I,{modelValue:V.value.code,"onUpdate:modelValue":B[10]||(B[10]=e=>V.value.code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])])),_:1}),(0,t.createVNode)(A,{label:"描述",prop:"description"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(I,{modelValue:V.value.description,"onUpdate:modelValue":B[11]||(B[11]=e=>V.value.description=e),placeholder:"请输入角色描述",autosize:{minRows:3,maxRows:6},type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}},520:function(e,a,l){e.exports=l(805)(6384)}}]);