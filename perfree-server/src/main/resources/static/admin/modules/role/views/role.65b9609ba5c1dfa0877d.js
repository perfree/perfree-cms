(self.webpackChunkmodules_role=self.webpackChunkmodules_role||[]).push([["views/role"],{2218:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var l=a(520),o=a(5428);function r(e,t){if(0===arguments.length||!e)return null;const a=t||"{y}-{m}-{d} {h}:{i}:{s}";let l;"object"==typeof e?l=e:("string"==typeof e&&/^[0-9]+$/.test(e)?e=parseInt(e):"string"==typeof e&&(e=e.replace(new RegExp(/-/gm),"/").replace("T"," ").replace(new RegExp(/\.\d{3}/gm),"")),"number"==typeof e&&10===e.toString().length&&(e*=1e3),l=new Date(e));const o={y:l.getFullYear(),m:l.getMonth()+1,d:l.getDate(),h:l.getHours(),i:l.getMinutes(),s:l.getSeconds(),a:l.getDay()};return a.replace(/{([ymdhisa])+}/g,((e,t)=>{let a=o[t];return"a"===t?["日","一","二","三","四","五","六"][a]:(e.length>0&&a<10&&(a="0"+a),a||0)}))}var n=a(35);const d={class:"page"},i={class:"search-box"},u={class:"right-tool"},c={class:"table-box"},s={style:{width:"100%",border:"1px solid rgb(228 231 237)",padding:"5px"}},p={class:"dialog-footer"},m={class:"dialog-footer"};var f={__name:"role",setup(e){let t=(0,l.ref)([]);const a={children:"children",label:"name"},f=(0,l.ref)({pageNo:1,pageSize:20,total:0,name:""}),v=(0,l.ref)({id:"",name:"",code:"",expand:!1,selectAll:!1}),h=(0,l.ref)({id:"",name:"",code:"",description:""}),V=(0,l.reactive)({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}]}),x=(0,l.ref)(),g=(0,l.ref)(),C=(0,l.ref)(),N=(0,l.ref)();let w=(0,l.ref)(!1),b=(0,l.ref)(!1),y=(0,l.ref)(""),k=(0,l.ref)([]),_=(0,l.ref)(!1),z=(0,l.ref)(!1);function E(){C.value.validate((e=>{var t;e&&(t=h.value,axios.post("/api/role/addOrUpdate",t)).then((e=>{200===e.code?(n.z8.success("操作成功"),b.value=!1,M(),R()):n.z8.error(e.msg)}))}))}function T(){y.value="添加角色",b.value=!0}function R(){var e;_.value=!0,(e=f.value,axios.post("/api/role/page",e)).then((e=>{k.value=e.data.list,f.value.total=e.data.total,_.value=!1}))}function U(){f.value={name:""},g.value.resetFields()}function M(){h.value={id:"",name:"",code:"",description:""},C.value.resetFields()}function j(){v.value={id:"",name:"",code:"",expand:!1,selectAll:!1},N.value.resetFields()}function F(){v.value.expand?Object.values(x.value.store.nodesMap).forEach((e=>e.expand())):Object.values(x.value.store.nodesMap).forEach((e=>e.collapse()))}function S(){v.value.selectAll?Object.values(x.value.store.nodesMap).forEach((e=>{e.checked=!0})):Object.values(x.value.store.nodesMap).forEach((e=>{e.checked=!1}))}function D(){var e;(e={menuIds:[...x.value.getCheckedKeys(),...x.value.getHalfCheckedKeys()],roleId:v.value.id},axios.post("/api/role/assignRoleMenu",e)).then((e=>{200===e.code&&e.data?(n.z8.success("操作成功"),w.value=!1,j()):n.z8.error(e.msg)}))}return R(),(e,O)=>{const A=(0,l.resolveComponent)("el-input"),I=(0,l.resolveComponent)("el-form-item"),B=(0,l.resolveComponent)("el-button"),H=(0,l.resolveComponent)("el-form"),K=(0,l.resolveComponent)("el-col"),Y=(0,l.resolveComponent)("el-row"),q=(0,l.resolveComponent)("el-table-column"),J=(0,l.resolveComponent)("el-popconfirm"),$=(0,l.resolveComponent)("el-table"),G=(0,l.resolveComponent)("el-pagination"),P=(0,l.resolveComponent)("el-checkbox"),L=(0,l.resolveComponent)("el-tree"),Q=(0,l.resolveComponent)("el-dialog"),W=(0,l.resolveDirective)("loading");return(0,l.openBlock)(),(0,l.createElementBlock)("div",d,[(0,l.createElementVNode)("div",i,[(0,l.createVNode)(H,{inline:!0,model:f.value,class:"demo-form-inline",ref_key:"searchFormRef",ref:g},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(I,{label:"角色名称"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(A,{modelValue:f.value.name,"onUpdate:modelValue":O[0]||(O[0]=e=>f.value.name=e),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])])),_:1}),(0,l.createVNode)(I,null,{default:(0,l.withCtx)((()=>[(0,l.createVNode)(B,{type:"primary",onClick:R,icon:(0,l.unref)(o.olm)},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("查询")])),_:1},8,["icon"]),(0,l.createVNode)(B,{icon:(0,l.unref)(o.hYj),onClick:U},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("重置")])),_:1},8,["icon"])])),_:1})])),_:1},8,["model"])]),(0,l.createVNode)(Y,{gutter:10,class:"mb8"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(K,{span:1.5},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(B,{icon:(0,l.unref)(o.v37),type:"primary",plain:"",onClick:T},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("新增")])),_:1},8,["icon"])])),_:1}),(0,l.createElementVNode)("div",u,[(0,l.createVNode)(B,{icon:(0,l.unref)(o.hYj),circle:"",onClick:R},null,8,["icon"])])])),_:1}),(0,l.createElementVNode)("div",c,[(0,l.withDirectives)(((0,l.openBlock)(),(0,l.createBlock)($,{data:(0,l.unref)(k),style:{width:"100%",height:"100%"},"row-key":"id"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(q,{prop:"name",label:"角色名称","min-width":"150"}),(0,l.createVNode)(q,{prop:"code",label:"角色编码","min-width":"150"}),(0,l.createVNode)(q,{prop:"description",label:"描述","min-width":"240"}),(0,l.createVNode)(q,{prop:"createTime",label:"创建时间","min-width":"120"},{default:(0,l.withCtx)((e=>[(0,l.createElementVNode)("span",null,(0,l.toDisplayString)((0,l.unref)(r)(e.row.createTime)),1)])),_:1}),(0,l.createVNode)(q,{label:"操作",width:"240",fixed:"right"},{default:(0,l.withCtx)((e=>[(0,l.createVNode)(B,{size:"small",type:"primary",link:"",icon:(0,l.unref)(o.I8b),onClick:t=>{return a=e.row,y.value="修改角色",b.value=!0,void(l=a.id,axios.get("/api/role/get?id="+l)).then((e=>{h.value=e.data}));var a,l}},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("修改")])),_:2},1032,["icon","onClick"]),(0,l.createVNode)(B,{size:"small",type:"primary",link:"",icon:(0,l.unref)(o.wn$),onClick:a=>{return l=e.row,w.value=!0,v.value.name=l.name,v.value.code=l.code,v.value.id=l.id,y.value="菜单权限",z.value=!0,void(o={},axios.post("/api/menu/list",o)).then((e=>{var a;t.value=function(e,t,a,l,o){t=t||"id",a=a||"parentId",l=l||"children",o=o||Math.min.apply(Math,e.map((e=>e[a])))||0;const r=JSON.parse(JSON.stringify(e)),n=r.filter((e=>{let l=r.filter((l=>e[t]===l[a]));return l.length>0&&(e.children=l),e[a]===o}));return""!==n?n:e}(e.data,"id","parentId","children","-1"),(a=l.id,axios.get("/api/role/getRoleMenus?id="+a)).then((e=>{x.value.setCheckedKeys(e.data),z.value=!1}))}));var l,o}},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("菜单权限")])),_:2},1032,["icon","onClick"]),(0,l.createVNode)(J,{"confirm-button-text":"确认","cancel-button-text":"取消",icon:(0,l.unref)(o.cEj),"icon-color":"#626AEF",title:"确定要删除该角色吗?",onConfirm:t=>{return a=e.row,void(l=a.id,axios.delete("/api/role/del?id="+l)).then((e=>{200===e.code&&e.data?(n.z8.success("删除成功"),R()):n.z8.error(e.msg)}));var a,l}},{reference:(0,l.withCtx)((()=>[(0,l.createVNode)(B,{size:"small",type:"primary",link:"",icon:(0,l.unref)(o.HG3)},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("删除")])),_:1},8,["icon"])])),_:2},1032,["icon","onConfirm"])])),_:1})])),_:1},8,["data"])),[[W,(0,l.unref)(_)]]),(0,l.createVNode)(G,{"current-page":f.value.pageNo,"onUpdate:currentPage":O[1]||(O[1]=e=>f.value.pageNo=e),"page-size":f.value.pageSize,"onUpdate:pageSize":O[2]||(O[2]=e=>f.value.pageSize=e),"page-sizes":[10,20,30,50],layout:"total,sizes,prev, pager, next, jumper",background:"",small:"",onChange:R,total:f.value.total},null,8,["current-page","page-size","total"])]),(0,l.createVNode)(Q,{modelValue:(0,l.unref)(w),"onUpdate:modelValue":O[8]||(O[8]=e=>(0,l.isRef)(w)?w.value=e:w=e),title:(0,l.unref)(y),width:"600px",draggable:""},{footer:(0,l.withCtx)((()=>[(0,l.createElementVNode)("span",p,[(0,l.createVNode)(B,{type:"primary",onClick:D},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("确 定")])),_:1}),(0,l.createVNode)(B,{onClick:O[7]||(O[7]=e=>{(0,l.isRef)(w)?w.value=!1:w=!1,j()})},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("取 消")])),_:1})])])),default:(0,l.withCtx)((()=>[(0,l.createVNode)(H,{ref_key:"menuFormRef",ref:N,model:v.value,"label-width":"120px",class:"demo-ruleForm","status-icon":""},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(I,{label:"角色名称",prop:"name"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(A,{modelValue:v.value.name,"onUpdate:modelValue":O[3]||(O[3]=e=>v.value.name=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,l.createVNode)(I,{label:"角色编码",prop:"code"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(A,{modelValue:v.value.code,"onUpdate:modelValue":O[4]||(O[4]=e=>v.value.code=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,l.createVNode)(I,{label:"菜单权限",prop:"code"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(P,{modelValue:v.value.expand,"onUpdate:modelValue":O[5]||(O[5]=e=>v.value.expand=e),label:"展开/折叠",onChange:F},null,8,["modelValue"]),(0,l.createVNode)(P,{modelValue:v.value.selectAll,"onUpdate:modelValue":O[6]||(O[6]=e=>v.value.selectAll=e),label:"全选/全不选",onChange:S},null,8,["modelValue"]),(0,l.createElementVNode)("div",s,[(0,l.withDirectives)((0,l.createVNode)(L,{props:a,data:(0,l.unref)(t),"node-key":"id","show-checkbox":"",ref_key:"menuTree",ref:x,"check-strictly":!0},null,8,["data"]),[[W,(0,l.unref)(z)]])])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"]),(0,l.createVNode)(Q,{modelValue:(0,l.unref)(b),"onUpdate:modelValue":O[13]||(O[13]=e=>(0,l.isRef)(b)?b.value=e:b=e),title:(0,l.unref)(y),width:"600px",draggable:""},{footer:(0,l.withCtx)((()=>[(0,l.createElementVNode)("span",m,[(0,l.createVNode)(B,{type:"primary",onClick:E},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("确 定")])),_:1}),(0,l.createVNode)(B,{onClick:O[12]||(O[12]=e=>{(0,l.isRef)(b)?b.value=!1:b=!1,M()})},{default:(0,l.withCtx)((()=>[(0,l.createTextVNode)("取 消")])),_:1})])])),default:(0,l.withCtx)((()=>[(0,l.createVNode)(H,{ref_key:"addFormRef",ref:C,model:h.value,"label-width":"120px","status-icon":"",rules:V},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(I,{label:"角色名称",prop:"name"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(A,{modelValue:h.value.name,"onUpdate:modelValue":O[9]||(O[9]=e=>h.value.name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),(0,l.createVNode)(I,{label:"角色编码",prop:"code"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(A,{modelValue:h.value.code,"onUpdate:modelValue":O[10]||(O[10]=e=>h.value.code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])])),_:1}),(0,l.createVNode)(I,{label:"描述",prop:"description"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)(A,{modelValue:h.value.description,"onUpdate:modelValue":O[11]||(O[11]=e=>h.value.description=e),placeholder:"请输入角色描述",autosize:{minRows:3,maxRows:6},type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}},520:function(e,t,a){e.exports=a(805)(6384)}}]);